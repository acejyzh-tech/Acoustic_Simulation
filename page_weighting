import streamlit as st
import pandas as pd
import altair as alt
import JYAcoustic as ac

freq0 = ""
for i in range(401): freq0 += str(10**(i/100+1))+"\n"
    
input_data = st.text_area("请输入频率点数据（每行一个频率值）", freq0)

# 处理数据
if st.button("计算计权值"):
    try:
        numbers = [float(line.strip()) for line in input_data.splitlines() if line.strip()]
        sine_values = [ac.sin(num) for num in numbers]  # 计算计权值
        
        # 创建 DataFrame
        df = pd.DataFrame({
            '频率': numbers,
            'A计权值': sine_values
        })
        
        # 使用 Altair 绘制折线图
        chart = alt.Chart(df).mark_line(point=True).encode(
            x=alt.X('频率:Q', title='频率 (Hz)', scale=alt.Scale(type='log')),
            y=alt.Y('A计权值:Q', title='A计权值 (dB)'),
            tooltip=['频率:Q', 'A计权值:Q']
        ).properties(
            title='数据正弦值折线图'
        )
        
        # 显示结果
        
        st.subheader("计权曲线")
        st.altair_chart(chart, use_container_width=True)
        
    except ValueError:
        st.error("请输入有效的数值！")
